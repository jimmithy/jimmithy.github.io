<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Jira &amp; Bitrise: Updating Tickets with New Builds</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Jira &amp; Bitrise: Updating Tickets with New Builds</h1>
</header>
<section data-field="subtitle" class="p-summary">
How to get Bitrise to post a comment in a Jira ticket when a build has completed.
</section>
<section data-field="body" class="e-content">
<section name="ed23" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="8ce2" id="8ce2" class="graf graf--h3 graf--leading graf--title">Jira &amp; Bitrise: Comments on New Builds</h3><p name="82e2" id="82e2" class="graf graf--p graf-after--h3">I joined a team this year which has been experimenting with using <a href="http://bitrise.io" data-href="http://bitrise.io" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Bitrise</a> for <a href="https://en.wikipedia.org/wiki/Continuous_integration" data-href="https://en.wikipedia.org/wiki/Continuous_integration" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Continuous Integration</a> of Android and iOS builds. I come from a Jenkins background, so it was a great opportunity to learn something new and overall I have been impressed by Bitrise’s simple to understand workflow with almost drag and drop components.</p><p name="187b" id="187b" class="graf graf--p graf-after--p">The problems I found was that the team members not working in engineering would often ask the developer for a link to the Bitrise build so they could download and test. The Bitrise job would output multiple files, so there were often questions over which build to use. We were also using the github plugin in Jira, but it was cumbersome to navigate through Jira, github, Bitrise to locate the latest build.</p><p name="27c8" id="27c8" class="graf graf--p graf-after--p">In an attempt to improve this process, I decided to write an addition to our Bitrise workflow which would post a comment on the Jira ticket once the build had completed.</p><h3 name="818d" id="818d" class="graf graf--h3 graf-after--p">Find Jira Tickets Script</h3><p name="3902" id="3902" class="graf graf--p graf-after--h3">The first problem I needed to solve was to figure out the relationship between Bitrise builds and Jira tickets. My workplace typically require that the Jira ticket is included in the commit message and/or the branch name. Fortunately, Bitrise provide these as an environment variables which I can then search for the ticket number.</p><p name="7cf1" id="7cf1" class="graf graf--p graf-after--p">I visited the workflow editor, selected my primary workflow, and added a new step at the end. I was unable to find an existing step that would identify Jira tickets, so I selected the <em class="markup--em markup--p-em">Script</em> step which would let me run my custom bash query.</p><figure name="79a0" id="79a0" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*Jqj-d7DLAO8XQAT7zUPEcg.png" data-width="894" data-height="474" src="https://cdn-images-1.medium.com/max/800/1*Jqj-d7DLAO8XQAT7zUPEcg.png"><figcaption class="imageCaption">I named it ‘Find Jira Issue’ so it could be easily identified in the workflow</figcaption></figure><h4 name="3729" id="3729" class="graf graf--h4 graf-after--figure">(Update)</h4><p name="4c14" id="4c14" class="graf graf--p graf-after--h4">I submitted this step to Bitrise to include in their catalog of steps, so you can now just select the Find Jira Issue step instead of selecting Script. The step will allow you to set the input and will output a list of unique tickets as <em class="markup--em markup--p-em">$JIRA_ISSUE_LIST</em>.</p><p name="f210" id="f210" class="graf graf--p graf-after--p"><a href="https://www.bitrise.io/integrations/steps/find-jira-issue" data-href="https://www.bitrise.io/integrations/steps/find-jira-issue" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">https://www.bitrise.io/integrations/steps/find-jira-issue</a></p><h4 name="9c86" id="9c86" class="graf graf--h4 graf-after--p">Searching the commit message for a ticket</h4><pre name="2041" id="2041" class="graf graf--pre graf-after--h4">#!/usr/bin/env bash<br>set -o pipefail</pre><pre name="040c" id="040c" class="graf graf--pre graf-after--pre">echo &quot;Extracting JIRA Issue number from commit message &#39;${BITRISE_GIT_MESSAGE}&quot;</pre><pre name="35e2" id="35e2" class="graf graf--pre graf-after--pre">JIRA_ISSUE=&quot;$(echo &quot;${BITRISE_GIT_MESSAGE}&quot; | egrep -o &#39;[a-zA-Z]+-[0-9]+&#39; | sort -uf | tr &#39;\n&#39; &#39;|&#39; | sed &#39;s/.$//&#39;)&quot;</pre><h4 name="8c9d" id="8c9d" class="graf graf--h4 graf-after--pre">Breaking down the query</h4><p name="d453" id="d453" class="graf graf--p graf-after--h4">The first step is to select the input. This can be different depending on your process. Some teams use the branch name to identify the ticket, others will add it to the commit message. Bitrise provides environment variables to identify each of these inputs so these can be used in your workflow step. Here is an example of using both the commit message and branch name as the input:</p><pre name="96ff" id="96ff" class="graf graf--pre graf-after--p">echo &quot;${BITRISE_GIT_MESSAGE} ${BITRISE_GIT_BRANCH}&quot;</pre><p name="1cdb" id="1cdb" class="graf graf--p graf-after--pre">Next we search for anything that matches a Jira ticket pattern, this is typically as follows:<br> 1. Upper or lower case text which will identify a Jira Project<br> 2. Separated by a hyphen <br> 3. Ends in a number, which will indicate the ticket id</p><pre name="6b90" id="6b90" class="graf graf--pre graf-after--p">egrep -o &#39;[a-zA-Z]+-[0-9]+&#39;</pre><p name="09c0" id="09c0" class="graf graf--p graf-after--pre">You could add character limits to both the Jira project and ticket number to enforce a specific pattern and reduce false matches, or if you use a single Jira project you can be specific about the name.</p><pre name="4ddc" id="4ddc" class="graf graf--pre graf-after--p">egrep -o &#39;PROJECT-[0–9]+&#39;</pre><p name="3b35" id="3b35" class="graf graf--p graf-after--pre">To ensure we find unique tickets, you can sort this list with flags specifying that the sorting is case insensitive and the output should remove any duplicates.</p><pre name="71e4" id="71e4" class="graf graf--pre graf-after--p">sort -uf</pre><p name="9551" id="9551" class="graf graf--p graf-after--pre">The search request will output each successful result on new lines and to make this Bitrise compatible we need to convert it to a pipe separated list. This request will replace any new line with a pipe.</p><pre name="183a" id="183a" class="graf graf--pre graf-after--p">tr &#39;\n&#39; &#39;|&#39;</pre><p name="e015" id="e015" class="graf graf--p graf-after--pre">The trim command will replace all new lines, which includes the final one at the end of the list. The last action to be taken is the replace method to remove the final entry.</p><pre name="2569" id="2569" class="graf graf--pre graf-after--p">sed &#39;s/.$//&#39;</pre><h4 name="2fff" id="2fff" class="graf graf--h4 graf-after--pre">Abort when no issue is found</h4><p name="3f63" id="3f63" class="graf graf--p graf-after--h4">This step was created to provide information for the next step in the workflow. If no ticket can be found we should mark the step as failed. This is important because we can set the next step to not run when the previous step is not successful.</p><pre name="de2c" id="de2c" class="graf graf--pre graf-after--p"># If no issue, abort<br>if [ -z &quot;${JIRA_ISSUE}&quot; ]; then<br>    echo &quot;Input doesn&#39;t contain Jira issue&quot;<br>    exit -1<br>fi</pre><p name="fdca" id="fdca" class="graf graf--p graf-after--pre">When a step fails, it will mark the entire build as a failure. <a href="https://devcenter.bitrise.io/tips-and-tricks/dont-mark-build-failed-if-step-fails/" data-href="https://devcenter.bitrise.io/tips-and-tricks/dont-mark-build-failed-if-step-fails/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">We can get around this by marking this step as skippable</a>, this can be done by editing the bitrise.yml file directly:</p><pre name="bb77" id="bb77" class="graf graf--pre graf-after--p">- find-jira-issue@0:<br>    is_skippable: true<br>    inputs: <br>        - find_issue_content: &quot;$BITRISE_GIT_MESSAGE&quot;</pre><h4 name="9b01" id="9b01" class="graf graf--h4 graf-after--pre">Save environment variable using <em class="markup--em markup--h4-em">envman</em></h4><p name="ffd9" id="ffd9" class="graf graf--p graf-after--h4">Now that we have successfully located the Jira ticket number, we need to tell Bitrise to pass this value to the next step of the workflow. This is done using a command called <a href="https://github.com/bitrise-io/envman/" data-href="https://github.com/bitrise-io/envman/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">envman</a> to add the result as an environment variable.</p><pre name="6938" id="6938" class="graf graf--pre graf-after--p">if command -v envman 2&gt;/dev/null; then<br>    echo &quot;Adding $JIRA_ISSUE to env. vars&quot;<br>    envman add --key JIRA_ISSUE --value &quot;${JIRA_ISSUE}&quot;<br>fi</pre><h3 name="6de5" id="6de5" class="graf graf--h3 graf-after--pre">Post Jira Comment Integration</h3><p name="01a1" id="01a1" class="graf graf--p graf-after--h3">I used the Bitrise provided <em class="markup--em markup--p-em">Post Jira Comment </em>workflow step. A link can be found below. I went with this approach because it removed the complication of authorization and formatting the HTTP Post request.</p><figure name="204d" id="204d" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*N2KQGHC0EA30lATq7phcRg.png" data-width="584" data-height="280" src="https://cdn-images-1.medium.com/max/800/1*N2KQGHC0EA30lATq7phcRg.png"><figcaption class="imageCaption">Make sure you toggle the box that indicates that this step should not run if the previous step failed.</figcaption></figure><h4 name="00f6" id="00f6" class="graf graf--h4 graf-after--figure">Secrets</h4><p name="e729" id="e729" class="graf graf--p graf-after--h4">Jira account username, password/api token, and base url. These are sensitive variables, and should be saved in the Bitrise secrets section so they are not outputted in the public Bitrise log. I would recommend creating a new Jira user for this account with the <a href="https://www.bitrise.io/presskit" data-href="https://www.bitrise.io/presskit" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">appropriate display picture</a>.</p><h4 name="5d0f" id="5d0f" class="graf graf--h4 graf-after--p">Jira issue keys</h4><p name="5669" id="5669" class="graf graf--p graf-after--h4">This is the environment variable we set in the previous workflow step. I called this $JIRA_ISSUE above.</p><h4 name="8970" id="8970" class="graf graf--h4 graf-after--p">Build Message</h4><p name="b2da" id="b2da" class="graf graf--p graf-after--h4">Identify what is important to the consumers of the comment. Ensure that it is clear, concise, and has easy to identify links to builds. Jira tables don’t handle multiple lines, so I also wrapped the commit message in no-format tag to ensure that it displays correctly.</p><pre name="c641" id="c641" class="graf graf--pre graf-after--p">(/) *$BITRISE_APP_TITLE* build *$BITRISE_BUILD_NUMBER* is now available<br>||Commit|{noformat}$BITRISE_GIT_MESSAGE{noformat}|<br>||Branch|$BITRISE_GIT_BRANCH|<br>||Hash|$GIT_CLONE_COMMIT_HASH|</pre><pre name="f7bf" id="f7bf" class="graf graf--pre graf-after--pre">[Download|$BITRISE_PUBLIC_INSTALL_PAGE_URL] | [Details|$BITRISE_BUILD_URL]</pre><figure name="5395" id="5395" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*YC98vJMPDxESSWJvmBEFjg.png" data-width="434" data-height="218" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*YC98vJMPDxESSWJvmBEFjg.png"><figcaption class="imageCaption">The Finished Result</figcaption></figure><p name="2d7c" id="2d7c" class="graf graf--p graf-after--figure">Overall this increased the productivity of our team and ensured that my colleagues could be effective with their time. By watching Jira tickets, colleagues would be notified by email when builds would be complete and it also provided a link to the public download page so it was easier for non-technical employees to download builds without navigating the Bitrise details page.</p><p name="5ff1" id="5ff1" class="graf graf--p graf-after--p graf--trailing">Hopefully the <em class="markup--em markup--p-em">find-jira-issues </em>workflow step<em class="markup--em markup--p-em"> </em>pull request is accepted, because I imagine this will be useful for other teams for all kinds of notifications and reporting.</p></div></div></section><section name="4617" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><div name="2dd6" id="2dd6" class="graf graf--mixtapeEmbed graf--leading"><a href="https://github.com/bitrise-steplib/steps-post-jira-comment-with-build-details" data-href="https://github.com/bitrise-steplib/steps-post-jira-comment-with-build-details" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://github.com/bitrise-steplib/steps-post-jira-comment-with-build-details"><strong class="markup--strong markup--mixtapeEmbed-strong">bitrise-steplib/steps-post-jira-comment-with-build-details</strong><br><em class="markup--em markup--mixtapeEmbed-em">Post comment to an issue on Jira Can be run directly with the bitrise CLI, just git clone this repository, cd into it&#39;s…</em>github.com</a><a href="https://github.com/bitrise-steplib/steps-post-jira-comment-with-build-details" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="ef189e06ca7ac24e86b8ab992ac36bf7" data-thumbnail-img-id="0*VL5zAfItxNpag2_D" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*VL5zAfItxNpag2_D);"></a></div><div name="4721" id="4721" class="graf graf--mixtapeEmbed graf-after--mixtapeEmbed graf--trailing"><a href="https://github.com/bitrise-io/bitrise-steplib/pull/2570" data-href="https://github.com/bitrise-io/bitrise-steplib/pull/2570" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://github.com/bitrise-io/bitrise-steplib/pull/2570"><strong class="markup--strong markup--mixtapeEmbed-strong">find-jira-issue 0.0.1 by jimmithy · Pull Request #2570 · bitrise-io/bitrise-steplib</strong><br><em class="markup--em markup--mixtapeEmbed-em">What to do if the build fails? At the moment contributors do not have access to the CI workflow triggered by StepLib…</em>github.com</a><a href="https://github.com/bitrise-io/bitrise-steplib/pull/2570" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="91339aeef1cdcf61ae584b2849219b53" data-thumbnail-img-id="0*YBdKTgwZFI-in_mh" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*YBdKTgwZFI-in_mh);"></a></div></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@jimmithy" class="p-author h-card">James O&#39;Brien</a> on <a href="https://medium.com/p/583861f7a5d5"><time class="dt-published" datetime="2020-06-26T19:31:28.726Z">June 26, 2020</time></a>.</p><p><a href="https://medium.com/@jimmithy/jira-bitrise-updating-tickets-with-new-builds-583861f7a5d5" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on February 18, 2026.</p></footer></article></body></html>